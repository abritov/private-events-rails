<% if notice %>
  <div class="flash-message flash-notice">
    <%= notice %>
  </div>
<% end %>

<% if alert %>
  <div class="flash-message flash-alert">
    <%= alert %>
  </div>
<% end %>

<% content_for :title, "Events" %>

<div class="events-container">
  <div class="events-header">
    <h1>Events</h1>

    <% if user_signed_in? %>
      <%= link_to new_event_path, class: 'btn btn-primary new-event-btn' do %>
        <span class="btn-icon">+</span> New Event
      <% end %>
    <% end %>
  </div>

  <!-- Events Filter Tabs -->
  <div class="events-filter">
    <div class="filter-tabs">
      <%= link_to 'All Events', events_path, class: "filter-tab #{'active' if @filter.nil? || @filter == 'all'}" %>
      <%= link_to 'Upcoming Events', events_path(filter: 'upcoming'), class: "filter-tab #{'active' if @filter == 'upcoming'}" %>
      <%= link_to 'Past Events', events_path(filter: 'past'), class: "filter-tab #{'active' if @filter == 'past'}" %>
    </div>

    <div class="events-count">
      <span class="count-badge">
        <%= pluralize(@events.count, 'event') %> found
      </span>
    </div>
  </div>

  <div class="events-grid">
    <% @events.each do |event| %>
      <div class="event-card <%= event.date < Time.current ? 'past-event' : 'upcoming-event' %>">
        <div class="event-header">
          <h3 class="event-title"><%= event.title %></h3>
          <div class="event-date-badges">
            <span class="event-date"><%= event.date.strftime('%b %d, %Y') %></span>
            <% if event.date < Time.current %>
              <span class="event-status past">Past</span>
            <% else %>
              <span class="event-status upcoming">Upcoming</span>
            <% end %>
          </div>
        </div>

        <div class="event-details">
          <p class="event-description"><%= truncate(event.description, length: 120) %></p>

          <div class="event-meta">
            <div class="meta-item">
              <span class="meta-icon">ğŸ“</span>
              <span class="meta-text"><%= event.location %></span>
            </div>

            <div class="meta-item">
              <span class="meta-icon">ğŸ‘¤</span>
              <span class="meta-text"><%= event.user.email %></span>
            </div>

            <div class="meta-item">
              <span class="meta-icon">ğŸ‘¥</span>
              <span class="meta-text"><%= pluralize(event.attendees.count, 'attendee') %></span>
            </div>
          </div>
        </div>

        <div class="event-actions">
          <%= link_to 'View Details', event, class: 'btn btn-outline' %>

          <% if user_signed_in? && event.user == current_user %>
            <div class="owner-actions">
              <%= link_to 'Edit', edit_event_path(event), class: 'btn btn-edit' %>
              <%= link_to 'Delete', event, method: :delete, data: { confirm: 'Are you sure you want to delete this event?' }, class: 'btn btn-delete' %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <% if @events.empty? %>
    <div class="empty-state">
      <div class="empty-icon">
        <% if @filter == 'past' %>
          ğŸ“š
        <% elsif @filter == 'upcoming' %>
          ğŸ¯
        <% else %>
          ğŸ“…
        <% end %>
      </div>
      <h3>
        <% if @filter == 'past' %>
          No Past Events
        <% elsif @filter == 'upcoming' %>
          No Upcoming Events
        <% else %>
          No Events Yet
        <% end %>
      </h3>
      <p>
        <% if @filter == 'past' %>
          Past events will appear here once they're completed.
        <% elsif @filter == 'upcoming' %>
          No upcoming events scheduled yet.
        <% else %>
          Be the first to create an event!
        <% end %>
      </p>
      <% if user_signed_in? %>
        <%= link_to 'Create New Event', new_event_path, class: 'btn btn-primary' %>
      <% else %>
        <%= link_to 'Sign in to Create Events', new_user_session_path, class: 'btn btn-primary' %>
      <% end %>
    </div>
  <% end %>
</div>
